<!DOCTYPE html>
<html>
<head>
  <title>Group Shirt Maker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root{
      /* TCP brand UI colors (app interface) */
      --tcp-accent: #de5935;
      --tcp-dark: #0a0a0a;
      --tcp-cream: #f8f7f2;
      --tcp-sand: #d9c5a7;
      --tcp-gold: #f7cd46;
      --tcp-tan: #bfae93;
      --tcp-mocha: #8f7f66;
      --tcp-white: #ffffff;
    }

    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
      background-color: var(--tcp-cream);
      color: var(--tcp-dark);
    }

    h1 { font-size: 34px; margin-bottom: 10px; }
    p  { font-size: 18px; margin-bottom: 20px; }

    .card {
      max-width: 980px;
      margin: 0 auto;
      padding: 30px;
      background-color: var(--tcp-white);
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    }

    .btn {
      padding: 14px 24px;
      margin: 10px;
      font-size: 16px;
      background-color: var(--tcp-accent);
      color: var(--tcp-white);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: 0.2s ease-in-out;
      display: inline-block;
      min-width: 180px;
    }

    .btn:hover { filter: brightness(0.92); }
    .secondary { background-color: var(--tcp-mocha); }
    .hidden { display: none; }

    .chip {
      display: inline-block;
      padding: 8px 14px;
      border-radius: 999px;
      background: var(--tcp-gold);
      color: var(--tcp-dark);
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 18px;
      border: 1px solid var(--tcp-tan);
      box-shadow: 0 3px 8px rgba(247, 205, 70, 0.35);
    }

    /* Two-column layout (Customize / Export) */
    .twoCol {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      margin-top: 18px;
      text-align: left;
      align-items: start;
    }

    .panel {
      border: 1px solid var(--tcp-sand);
      border-radius: 14px;
      padding: 16px;
      background: #fff;
      overflow: visible;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 700;
      margin: 12px 0 6px 0;
      color: var(--tcp-dark);
    }

    input, select {
      width: 100%;
      box-sizing: border-box;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--tcp-sand);
      font-size: 16px;
      outline: none;
      background: white;
      color: var(--tcp-dark);
    }

    input:focus, select:focus {
      border-color: var(--tcp-accent);
      box-shadow: 0 0 0 3px rgba(222, 89, 53, 0.18);
    }

    /* Preview box (on Customize screen) */
    .previewBox {
      border-radius: 16px;
      padding: 26px;
      border: 1px dashed var(--tcp-tan);
      min-height: 280px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      background: #ffffff;
    }

    .previewInner {
      max-width: 440px;
      line-height: 1.05;
      word-break: break-word;
    }

    .prevMain { font-size: 46px; font-weight: 900; margin-bottom: 10px; }
    .prevSub  { font-size: 22px; font-weight: 800; margin-bottom: 8px; }
    .prevMeta { font-size: 18px; font-weight: 700; opacity: 0.92; }

    .tinyNote {
      font-size: 13px;
      color: var(--tcp-mocha);
      margin-top: 10px;
      line-height: 1.25;
    }

    .footerBtns {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    /* Export preview (shows checkerboard for transparency) */
    .checker {
      background:
        linear-gradient(45deg, #e9e9e9 25%, transparent 25%),
        linear-gradient(-45deg, #e9e9e9 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #e9e9e9 75%),
        linear-gradient(-45deg, transparent 75%, #e9e9e9 75%);
      background-size: 24px 24px;
      background-position: 0 0, 0 12px, 12px -12px, -12px 0px;
      border-radius: 16px;
      border: 1px solid var(--tcp-sand);
      padding: 14px;
    }

    canvas {
      width: 100%;
      height: auto;
      border-radius: 12px;
      display: block;
    }

    .steps {
      margin: 8px 0 0 18px;
      padding: 0;
      color: var(--tcp-dark);
      line-height: 1.4;
    }

    @media (max-width: 900px) {
      body { padding: 20px; }
      .btn { min-width: 220px; }
      .twoCol { grid-template-columns: 1fr; }
      .previewBox { min-height: 240px; }
    }
  </style>
</head>

<body>

  <!-- HOME -->
  <div id="homeScreen" class="card">
    <h1>Group Shirt Maker</h1>
    <p>Design your group shirt in under 2 minutes.</p>
    <button class="btn" onclick="showEventScreen()">Start New Design</button>
  </div>

  <!-- EVENTS -->
  <div id="eventScreen" class="card hidden">
    <h1>Choose Your Event</h1>

    <button class="btn" onclick="chooseEvent('Family Reunion')">Family Reunion</button>
    <button class="btn" onclick="chooseEvent('Girls Trip')">Girls Trip</button>
    <button class="btn" onclick="chooseEvent('Birthday')">Birthday</button>
    <button class="btn" onclick="chooseEvent('Class Reunion')">Class Reunion</button>
    <button class="btn" onclick="chooseEvent('Wedding Party')">Wedding Party</button>
    <button class="btn" onclick="showMoreOptionsScreen()">More Options</button>

    <br><br>
    <button class="btn secondary" onclick="goHome()">Back</button>
  </div>

  <!-- MORE OPTIONS -->
  <div id="moreOptionsScreen" class="card hidden">
    <h1>More Options</h1>
    <p>Choose an occasion (or select Custom Shirt).</p>

    <button class="btn" onclick="chooseEvent('Custom Shirt')">Custom Shirt</button>
    <button class="btn" onclick="chooseEvent('Baby Shower')">Baby Shower</button>
    <button class="btn" onclick="chooseEvent('Retirement Party')">Retirement Party</button>
    <button class="btn" onclick="chooseEvent('Graduation')">Graduation</button>
    <button class="btn" onclick="chooseEvent('Anniversary')">Anniversary</button>
    <button class="btn" onclick="chooseEvent('Text Only')">Text Only</button>

    <br><br>
    <button class="btn secondary" onclick="backToEvents()">Back</button>
  </div>

  <!-- TEMPLATES -->
  <div id="templateScreen" class="card hidden">
    <div class="chip" id="selectedEventChip">Event: â€”</div>
    <h1>Choose a Template</h1>
    <p>Pick a layout style. Youâ€™ll customize text next.</p>

    <button class="btn" onclick="chooseTemplate('Big Bold Stack')">Big Bold Stack</button>
    <button class="btn" onclick="chooseTemplate('Circle Badge')">Circle Badge</button>
    <button class="btn" onclick="chooseTemplate('Minimal Line + Year')">Minimal Line + Year</button>

    <br><br>
    <button class="btn secondary" onclick="backToEvents()">Back</button>
  </div>

  <!-- CUSTOMIZE -->
  <div id="customizeScreen" class="card hidden">
    <div class="chip" id="customizeChip">Event: â€” | Template: â€”</div>
    <h1>Customize Your Shirt</h1>
    <p>Type your text and pick colors. Preview updates as you type.</p>

    <div class="twoCol">
      <!-- Controls -->
      <div class="panel">
        <label for="mainText">Main Text</label>
        <input id="mainText" type="text" placeholder="e.g., SMITH FAMILY" oninput="updatePreview()">

        <label for="subText">Subtitle</label>
        <input id="subText" type="text" placeholder="e.g., REUNION" oninput="updatePreview()">

        <label for="yearText">Year</label>
        <input id="yearText" type="text" placeholder="e.g., 2026" oninput="updatePreview()">

        <label for="locText">Location (optional)</label>
        <input id="locText" type="text" placeholder="e.g., Atlanta, GA" oninput="updatePreview()">

        <label for="fontStyle">Font Style</label>
        <select id="fontStyle" onchange="updatePreview()">
          <option value="bold">Bold & Clean</option>
          <option value="modern">Modern Minimal</option>
          <option value="classic">Classic Serif</option>
        </select>

        <label for="mainColor">Main Text Color</label>
        <select id="mainColor" onchange="updatePreview()">
          <option value="#ffffff">âšª White</option>
          <option value="#0a0a0a">âš« Black</option>
          <option value="#f7cd46">ðŸŸ¡ Gold</option>
          <option value="#de5935">ðŸ”´ Red</option>
          <option value="#f8f7f2">âšª Cream / Off-White</option>
          <option value="#7fb8ff">ðŸ”µ Light Blue</option>
          <option value="#F4C2C2">ðŸŸ£ Baby Girl Pink</option>
          <option value="#ff4fa3">ðŸŸ£ Pink</option>
          <option value="#ff6a00">ðŸŸ  Neon Orange</option>
          <option value="#00a651">ðŸŸ¢ Kelly Green</option>
          <option value="#c0c0c0">âšª Silver</option>
          <option value="#800020">ðŸŸ£ Burgundy</option>
          <option value="#000080">ðŸ”µ Navy Blue</option>
        </select>

        <label for="subColor">Subtitle Color (Optional)</label>
        <select id="subColor" onchange="updatePreview()">
          <option value="none">âŠ˜ None</option>
          <option value="#ffffff">âšª White</option>
          <option value="#0a0a0a">âš« Black</option>
          <option value="#f7cd46">ðŸŸ¡ Gold</option>
          <option value="#de5935">ðŸ”´ Red</option>
          <option value="#f8f7f2">âšª Cream / Off-White</option>
          <option value="#7fb8ff">ðŸ”µ Light Blue</option>
          <option value="#F4C2C2">ðŸŸ£ Baby Girl Pink</option>
          <option value="#ff4fa3">ðŸŸ£ Pink</option>
          <option value="#ff6a00">ðŸŸ  Neon Orange</option>
          <option value="#00a651">ðŸŸ¢ Kelly Green</option>
          <option value="#c0c0c0">âšª Silver</option>
          <option value="#800020">ðŸŸ£ Burgundy</option>
          <option value="#000080">ðŸ”µ Navy Blue</option>
        </select>

        <div style="margin-top:12px;">
  <label style="display:block;font-size:14px;font-weight:700;margin:12px 0 6px;">Main Text Color (Swatch Demo)</label>

  <div class="swatchSelect" id="swatchDemo">
    <button type="button" class="swatchBtn" onclick="toggleSwatchMenu('swatchDemoMenu')">
      <span class="dot" style="background:#000080;"></span>
      <span class="swatchLabel" id="swatchDemoLabel">Navy Blue</span>
      <span class="caret">â–¾</span>
    </button>

    <div class="swatchMenu hidden" id="swatchDemoMenu">
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#000080','Navy Blue','swatchDemoMenu')">
        <span class="dot" style="background:#000080;"></span> Navy Blue
      </div>
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#7fb8ff','Light Blue','swatchDemoMenu')">
        <span class="dot" style="background:#7fb8ff;"></span> Light Blue
      </div>
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#F4C2C2','Baby Girl Pink','swatchDemoMenu')">
        <span class="dot" style="background:#F4C2C2;"></span> Baby Girl Pink
      </div>
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#f7cd46','Gold','swatchDemoMenu')">
        <span class="dot" style="background:#f7cd46;"></span> Gold
      </div>
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#0a0a0a','Black','swatchDemoMenu')">
        <span class="dot" style="background:#0a0a0a;"></span> Black
      </div>
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#ffffff','White','swatchDemoMenu')">
        <span class="dot" style="background:#ffffff;border:1px solid #d9c5a7;"></span> White
       </div>
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#800020','Burgundy','swatchDemoMenu')">
        <span class="dot" style="background:#800020;"></span> Burgundy
      </div>
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#00a651','Kelly Green','swatchDemoMenu')">
      <span class="dot" style="background:#00a651;"></span> Kelly Green
      </div>
      <div class="swatchItem" onclick="pickSwatch('swatchDemoLabel','#ff6a00','Neon Orange','swatchDemoMenu')">
      <span class="dot" style="background:#ff6a00;"></span> Neon Orange
      </div>
    </div>
  </div>
</div>

<style>
  /* Swatch dropdown styling (matches your app vibe) */
  .swatchSelect { position: relative; width: 100%; }
  .swatchBtn{
    width: 100%;
    display:flex;
    align-items:center;
    gap:10px;
    padding:12px;
    border-radius:10px;
    border:1px solid #d9c5a7;
    background:#fff;
    cursor:pointer;
    font-size:16px;
    color:#0a0a0a;
  }
  .dot{
    width:14px; height:14px; border-radius:999px; flex:0 0 14px;
  }
  .swatchLabel{ flex:1; text-align:left; }
  .caret{ opacity:0.7; }
  .swatchMenu{
    position:absolute;
    top:calc(100% + 6px);
    left:0;
    right:0;
    border:1px solid #d9c5a7;
    border-radius:10px;
    background:#fff;
    box-shadow:0 10px 24px rgba(0,0,0,0.10);
    padding:6px;
    z-index:9999;
  }
  .swatchItem{
    display:flex;
    align-items:center;
    gap:10px;
    padding:10px 10px;
    border-radius:8px;
    cursor:pointer;
    color:#0a0a0a;
    font-size:15px;
  }
  .swatchItem:hover{ background:#f8f7f2; }
  .hidden{ display:none; }
</style>

<script>
  function toggleSwatchMenu(menuId){
    document.getElementById(menuId).classList.toggle('hidden');
  }
  function pickSwatch(labelId, hex, name, menuId){
    const label = document.getElementById(labelId);
    label.textContent = name;

    // update the dot in the button (the first .dot inside the button)
    const btn = label.closest('.swatchBtn') || label.parentElement;
    const dot = btn.querySelector('.dot');
    dot.style.background = hex;

    document.getElementById(menuId).classList.add('hidden');
  }
</script>

        <div class="tinyNote">
          Next step will export a Printify-ready file (PNG = Portable Network Graphics) with a transparent background.
          Youâ€™ll choose your shirt color inside Printify.
        </div>
      </div>

      <!-- Preview -->
      <div class="panel">
        <div id="previewBox" class="previewBox">
          <div class="previewInner">
            <div class="prevMain" id="prevMain">YOUR TEXT</div>
            <div class="prevSub" id="prevSub">Subtitle</div>
            <div class="prevMeta" id="prevMeta">Year â€¢ Location</div>
          </div>
        </div>
        <div class="tinyNote">
          Preview may switch to a dark background when you pick light text colors (for visibility).
        </div>
      </div>
    </div>

    <div class="footerBtns">
      <button class="btn secondary" onclick="backToTemplates()">Back</button>
      <button class="btn" onclick="goToExport()">Next</button>
    </div>
  </div>

  <!-- EXPORT -->
  <div id="exportScreen" class="card hidden">
    <div class="chip" id="exportChip">Export: â€”</div>
    <h1>Export Your Design</h1>
    <p>Download a transparent PNG, ready to upload to Printify.</p>

    <div class="twoCol">
      <!-- Instructions -->
      <div class="panel">
        <h3 style="margin-top:0;">How to use this file</h3>
        <ul class="steps">
          <li>Click <b>Download PNG</b>.</li>
          <li>In Printify, choose a product (T-shirt, hoodie, etc.).</li>
          <li>Upload your PNG file (it has a transparent background).</li>
          <li>Select your shirt color inside Printify.</li>
        </ul>

        <div class="tinyNote">
          Export size: <b>4500 Ã— 5400 px</b> (good for most shirt prints).<br>
          Background: <b>Transparent</b> (so Printify can place it on any color).
        </div>

        <div class="footerBtns" style="justify-content:flex-start;">
          <button class="btn secondary" onclick="backToCustomize()">Back</button>
          <button class="btn" onclick="downloadPNG()">Download PNG</button>
        </div>
      </div>

      <!-- Canvas preview -->
      <div class="panel">
        <div class="checker">
          <canvas id="exportCanvas" width="4500" height="5400"></canvas>
        </div>
        <div class="tinyNote">
          Checkerboard = transparency. Your downloaded PNG will be transparent.
        </div>
      </div>
    </div>
  </div>

  <script>
    let selectedEvent = "";
    let selectedTemplate = "";

    function hideAll() {
      document.getElementById("homeScreen").classList.add("hidden");
      document.getElementById("eventScreen").classList.add("hidden");
      document.getElementById("moreOptionsScreen").classList.add("hidden");
      document.getElementById("templateScreen").classList.add("hidden");
      document.getElementById("customizeScreen").classList.add("hidden");
      document.getElementById("exportScreen").classList.add("hidden");
    }

    function showEventScreen() {
      hideAll();
      document.getElementById("eventScreen").classList.remove("hidden");
    }

    function showMoreOptionsScreen() {
      hideAll();
      document.getElementById("moreOptionsScreen").classList.remove("hidden");
    }

    function goHome() {
      hideAll();
      document.getElementById("homeScreen").classList.remove("hidden");
    }

    function backToEvents() {
      hideAll();
      document.getElementById("eventScreen").classList.remove("hidden");
    }

    function chooseEvent(eventName) {
      selectedEvent = eventName;

        // ðŸ”¹ Reset fields so each event starts clean
      resetCustomizeFields();

      document.getElementById("selectedEventChip").textContent = "Event: " + selectedEvent;
      hideAll();
      document.getElementById("templateScreen").classList.remove("hidden");
}

    function chooseTemplate(templateName) {
      selectedTemplate = templateName;
      document.getElementById("customizeChip").textContent =
        "Event: " + selectedEvent + " | Template: " + selectedTemplate;

      prefillDefaults();
      hideAll();
      document.getElementById("customizeScreen").classList.remove("hidden");
      updatePreview();
    }

    function backToTemplates() {
      hideAll();
      document.getElementById("templateScreen").classList.remove("hidden");
    }

    function backToCustomize() {
      hideAll();
      document.getElementById("customizeScreen").classList.remove("hidden");
    }
    function resetCustomizeFields() {
  // Clear text fields so a new event starts fresh
  document.getElementById("mainText").value = "";
  document.getElementById("subText").value = "";
  document.getElementById("yearText").value = "";
  document.getElementById("locText").value = "";

  // Reset style
  document.getElementById("fontStyle").value = "bold";

  // If you still have the old dropdown selects, reset them safely
  const mainColor = document.getElementById("mainColor");
  const subColor = document.getElementById("subColor");
  if (mainColor) mainColor.value = "#ffffff";
  if (subColor) subColor.value = "none";

  // If swatches are integrated later, weâ€™ll reset those too (next step)
}
    function prefillDefaults() {
      const main = document.getElementById("mainText");
      const sub  = document.getElementById("subText");
      const year = document.getElementById("yearText");
      const loc  = document.getElementById("locText");

      if (!year.value) year.value = "2026";

      if (!main.value && selectedEvent === "Family Reunion") main.value = "SMITH FAMILY";
      if (!sub.value  && selectedEvent === "Family Reunion") sub.value  = "REUNION";

      if (!main.value && selectedEvent === "Girls Trip") main.value = "GIRLS TRIP";
      if (!sub.value  && selectedEvent === "Girls Trip") sub.value  = "WEEKEND CREW";

      if (!main.value && selectedEvent === "Birthday") main.value = "BIRTHDAY SQUAD";
      if (!sub.value  && selectedEvent === "Birthday") sub.value  = "CELEBRATE";

      if (!main.value && selectedEvent === "Baby Shower") main.value = "BABY SHOWER";
      if (!sub.value  && selectedEvent === "Baby Shower") sub.value  = "SHOWER CREW";

      if (!main.value && selectedEvent === "Text Only") main.value = "TEMPORARILY";
      if (!sub.value  && selectedEvent === "Text Only") sub.value  = "OUT OF ORDER";

      if (!loc.value) loc.value = "";
    }

     function updatePreview() {
   // --- Grab input values (NO placeholder defaults) ---
      const titleVal = (document.getElementById("titleText")?.value || "").trim();
      const subVal = (document.getElementById("subText")?.value || "").trim().toUpperCase();
      const yearVal = (document.getElementById("yearText")?.value || "").trim();
      const locVal  = (document.getElementById("locText")?.value  || "").trim();

    // --- Preview elements ---
      const titleEl = document.getElementById("prevTitle");
      const subEl   = document.getElementById("prevSub");
      const metaEl  = document.getElementById("prevMeta");

    // Helper: set text + hide if empty
      const setPreviewText = (el, value, displayWhenShown = "block") => {
      if (!el) return;
      const text = (value || "").toString().trim();
      el.textContent = text;
      el.style.display = text ? displayWhenShown : "none";
    };

    // --- Title (usually always shown; adjust if you want it hideable too) ---
      if (titleEl) titleEl.textContent = titleVal || ""; // keep blank if empty

    // --- Subtitle: hide if empty ---
      setPreviewText(subEl, subVal);

    // --- Meta (Year â€¢ Location): build only from fields that exist ---
      let meta = "";
      if (yearVal && locVal) meta = `${yearVal} â€¢ ${locVal}`;
      else if (yearVal) meta = yearVal;
      else if (locVal) meta = locVal;

    // Hide meta line if empty
  setPreviewText(metaEl, meta);

    // ------------------------------------------------------------------
    // Keep the rest of your existing preview logic below:
    // - template selection (Big Bold Stack / Circle Badge / Minimal Line + Year)
    // - colors / swatches
    // - font sizes
    // - anything else you're already doing
    // ------------------------------------------------------------------
}

      // Fonts (simple built-ins)
      const fontStyle = document.getElementById("fontStyle").value;
      const prevMain = document.getElementById("prevMain");
      const prevSub = document.getElementById("prevSub");
      const prevMeta = document.getElementById("prevMeta");

      if (fontStyle === "bold") {
        prevMain.style.fontFamily = "Arial, sans-serif";
        prevSub.style.fontFamily  = "Arial, sans-serif";
        prevMeta.style.fontFamily = "Arial, sans-serif";
        prevMain.style.letterSpacing = "0.5px";
      } else if (fontStyle === "modern") {
        prevMain.style.fontFamily = "Trebuchet MS, Arial, sans-serif";
        prevSub.style.fontFamily  = "Trebuchet MS, Arial, sans-serif";
        prevMeta.style.fontFamily = "Trebuchet MS, Arial, sans-serif";
        prevMain.style.letterSpacing = "1px";
      } else {
        prevMain.style.fontFamily = "Georgia, serif";
        prevSub.style.fontFamily  = "Georgia, serif";
        prevMeta.style.fontFamily = "Georgia, serif";
        prevMain.style.letterSpacing = "0px";
      }

      // Colors
      const mainColor = document.getElementById("mainColor").value.toLowerCase();
      const subColor  = document.getElementById("subColor").value.toLowerCase();

      prevMain.style.color = mainColor;
      prevMeta.style.color = mainColor;
      prevSub.style.color  = (subColor === "none") ? mainColor : subColor;

      // Preview background visibility helper
      const box = document.getElementById("previewBox");
      const isLightMain =
        mainColor === "#ffffff" ||
        mainColor === "#f8f7f2" ||
        mainColor === "#c0c0c0" ||
        mainColor === "#f7cd46";

      if (isLightMain) {
        box.style.backgroundColor = "#0a0a0a";
        box.style.borderColor = "#8f7f66";
      } else {
        box.style.backgroundColor = "#ffffff";
        box.style.borderColor = "#bfae93";
      }
    }

    // -------- EXPORT ENGINE --------

    function goToExport() {
      hideAll();
      document.getElementById("exportScreen").classList.remove("hidden");

      const mainVal = (document.getElementById("mainText").value || "YOUR TEXT").toUpperCase();
      const subVal  = (document.getElementById("subText").value || "").toUpperCase();
      const yearVal = (document.getElementById("yearText").value || "").trim();
      const locVal  = (document.getElementById("locText").value || "").trim();

      const chip = document.getElementById("exportChip");
      chip.textContent = "Export: " + selectedEvent + " | " + selectedTemplate;

      // Draw export canvas
      renderExportCanvas({
        mainText: mainVal,
        subText: subVal,
        yearText: yearVal,
        locText: locVal,
        fontStyle: document.getElementById("fontStyle").value,
        mainColor: document.getElementById("mainColor").value,
        subColor: document.getElementById("subColor").value
      });
    }

    function renderExportCanvas(data) {
      const canvas = document.getElementById("exportCanvas");
      const ctx = canvas.getContext("2d");

      // Clear to transparent
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Choose fonts
      let fontMain = "900 360px Arial";
      let fontSub  = "800 180px Arial";
      let fontMeta = "700 150px Arial";

      if (data.fontStyle === "modern") {
        fontMain = "900 340px 'Trebuchet MS', Arial";
        fontSub  = "800 170px 'Trebuchet MS', Arial";
        fontMeta = "700 140px 'Trebuchet MS', Arial";
      } else if (data.fontStyle === "classic") {
        fontMain = "900 340px Georgia";
        fontSub  = "800 170px Georgia";
        fontMeta = "700 140px Georgia";
      }

      // Build meta line
      let meta = "";
      if (data.yearText && data.locText) meta = data.yearText + " â€¢ " + data.locText;
      else if (data.yearText) meta = data.yearText;
      else if (data.locText) meta = data.locText;

      // Colors
      const mainColor = data.mainColor;
      const subColor  = (data.subColor === "none") ? data.mainColor : data.subColor;

      // Template-based layout
      // (Simple MVP layouts; we can make richer later.)
      if (selectedTemplate === "Circle Badge") {
        // Draw a simple circular badge stroke (transparent background still)
        const cx = 2250, cy = 2200;
        const r = 1300;

        ctx.save();
        ctx.beginPath();
        ctx.lineWidth = 40;
        ctx.strokeStyle = mainColor;
        ctx.globalAlpha = 0.55;
        ctx.arc(cx, cy, r, 0, Math.PI * 2);
        ctx.stroke();
        ctx.restore();

        // Text inside badge
        drawCenteredLines(ctx, data.mainText, fontMain, mainColor, 2250, 1900, 420);
        if (data.subText) drawCenteredLine(ctx, data.subText, fontSub, subColor, 2250, 2700);
        if (meta) drawCenteredLine(ctx, meta, fontMeta, mainColor, 2250, 3050);

      } else if (selectedTemplate === "Minimal Line + Year") {
        // Minimal style: main text, thin line, year + location
        drawCenteredLine(ctx, data.mainText, fontMain, mainColor, 2250, 2200);

        ctx.save();
        ctx.beginPath();
        ctx.strokeStyle = subColor;
        ctx.lineWidth = 24;
        ctx.globalAlpha = 0.9;
        ctx.moveTo(1100, 2650);
        ctx.lineTo(3400, 2650);
        ctx.stroke();
        ctx.restore();

        if (data.subText) drawCenteredLine(ctx, data.subText, fontSub, subColor, 2250, 2950);
        if (meta) drawCenteredLine(ctx, meta, fontMeta, mainColor, 2250, 3300);

      } else {
        // Big Bold Stack (default)
        drawCenteredLines(ctx, data.mainText, fontMain, mainColor, 2250, 2150, 420);
        if (data.subText) drawCenteredLine(ctx, data.subText, fontSub, subColor, 2250, 3050);
        if (meta) drawCenteredLine(ctx, meta, fontMeta, mainColor, 2250, 3400);
      }
    }

    function drawCenteredLine(ctx, text, font, color, x, y) {
      ctx.save();
      ctx.font = font;
      ctx.fillStyle = color;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(text, x, y);
      ctx.restore();
    }

    // Splits long main text into up to 2 lines (simple but effective)
    function drawCenteredLines(ctx, text, font, color, x, y, maxWidth) {
      ctx.save();
      ctx.font = font;
      ctx.fillStyle = color;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      const words = text.split(" ");
      if (words.length <= 1) {
        ctx.fillText(text, x, y);
        ctx.restore();
        return;
      }

      // Try best split into 2 lines
      let bestA = "", bestB = "", bestDiff = Infinity;

      for (let i = 1; i < words.length; i++) {
        const a = words.slice(0, i).join(" ");
        const b = words.slice(i).join(" ");
        const wa = ctx.measureText(a).width;
        const wb = ctx.measureText(b).width;

        if (wa <= 3200 && wb <= 3200) {
          const diff = Math.abs(wa - wb);
          if (diff < bestDiff) {
            bestDiff = diff;
            bestA = a; bestB = b;
          }
        }
      }

      if (!bestA) {
        // fallback: just draw one line
        ctx.fillText(text, x, y);
        ctx.restore();
        return;
      }

      ctx.fillText(bestA, x, y - 220);
      ctx.fillText(bestB, x, y + 220);
      ctx.restore();
    }

    function downloadPNG() {
      const canvas = document.getElementById("exportCanvas");
      const link = document.createElement("a");
      const safeEvent = (selectedEvent || "design").toLowerCase().replace(/[^a-z0-9]+/g, "-");
      const safeTemplate = (selectedTemplate || "template").toLowerCase().replace(/[^a-z0-9]+/g, "-");
      link.download = safeEvent + "-" + safeTemplate + ".png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }
  </script>

</body>
</html>
